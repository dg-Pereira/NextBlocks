{"version":3,"file":"lib.min.js","sources":["../src/lib.js"],"sourcesContent":["/**\n *\n * @module      mod_nextblocks/env\n * @copyright   2023 Duarte Pereira<dg.pereira@campus.fct.unl.pt>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* globals javascript */\n\n/**\n * Injects the box for inserting the program input below the blockly area\n * @param {Number} i the index of the input box, to avoid repetition of ids\n */\nexport const injectInputBox = (i) => {\n    // Create input box for program input\n    const inputBox = document.createElement('input');\n    inputBox.setAttribute('type', 'text');\n    inputBox.setAttribute('id', 'programInputBox' + i);\n\n    // Create button to submit input\n    const submitButton = document.createElement('button');\n    submitButton.setAttribute('id', 'programInputButton' + i);\n    submitButton.setAttribute('type', 'button');\n    submitButton.innerHTML = 'Submit';\n\n    // Insert input box and button below blockly area\n    const blocklyDiv = document.getElementById('blocklyDiv');\n    blocklyDiv.insertAdjacentElement('afterend', inputBox);\n    inputBox.insertAdjacentElement('afterend', submitButton);\n};\n\n/**\n * Inserts the new program code in the code div below the blockly area, replacing the old one if it exists\n * @param {String} code the new program code to be displayed\n */\nexport const replaceCode = (code) => {\n    const codeDiv = document.getElementById('codeDiv');\n    codeDiv.innerHTML = formatCodeHTML(code);\n};\n\n/**\n * Formats the code with correct HTML structure to be displayed in the code div\n * TODO: implement this function\n * @param {String} code the code text to be formatted (string literal)\n * @returns {String} the formatted code\n */\nconst formatCodeHTML = (code) => {\n    code = removeWrapperFunction(code);\n    // Code is string literal\n    return \"<pre>\" + code + \"</pre>\";\n};\n\n/**\n * Removes the wrapper function from the code for presentation purposes\n * Removes first two and last three lines\n * @param {String} code the code to be modified\n * @returns {String} the code without the wrapper function\n */\nconst removeWrapperFunction = (code) => {\n    const lines = code.split('\\n');\n    lines.splice(0, 2);\n    lines.splice(-3);\n    return lines.join('\\n');\n};\n\n/**\n * Runs the tests on the given workspace and returns an array of booleans, one for each test, indicating whether\n * the test passed or not\n * @param {WorkspaceSvg} workspace the workspace to run the tests on\n * @param {{}} tests the tests to run\n * @returns {any[]} an array of booleans, one for each test, indicating whether the test passed or not\n */\nexport const runTests = (workspace, tests) => {\n    // eslint-disable-next-line no-unused-vars\n    const code = getWorkspaceCode(workspace);\n    let results = [];\n    tests.forEach((test) => {\n        let thisTestCode = code; // Need to copy, so that the code is not modified for the next test\n        const inputs = test.inputs;\n        inputs.forEach((input) => {\n            // eslint-disable-next-line no-console\n            const prompt = Object.keys(input)[0];\n            const values = input[prompt];\n\n            const inputIndex = thisTestCode.indexOf(prompt);\n            // Get index of first string literal after prompt\n            let inputQuote1 = thisTestCode.indexOf('\"', inputIndex);\n            const inputQuote2 = thisTestCode.indexOf('\"', inputQuote1 + 1);\n\n            const preStr = thisTestCode.substring(0, inputQuote1 + 1);\n            const postStr = thisTestCode.substring(inputQuote2);\n\n            thisTestCode = preStr + values[0] + postStr;\n\n        });\n        // eslint-disable-next-line no-eval\n        const codeOutput = eval(thisTestCode);\n        results.push(codeOutput);\n    });\n    return results;\n};\n\n/**\n * @param {WorkspaceSvg} workspace the workspace to get the code from\n * @returns {String} the code generated by Blockly for the current workspace\n *\n * Returns the Javascript code string generated by Blockly, with the necessary wrapping code\n */\nexport const getWorkspaceCode = (workspace) => {\n    let code = javascript.javascriptGenerator.workspaceToCode(workspace);\n    const preamble = `(function () {\n    let outputString = \\`\\`;\\n`;\n    const postscript = `return outputString;\n})();\\n`;\n    // Add a preamble and a postscript to the code.\n    code = preamble + code + postscript;\n    return code;\n};\n\nexport const testsAccordion = (results, testsJSON) => {\n    const testCaseCount = testsJSON.length;\n\n    let accordion = '<div style=\"max-height: 100%; overflow-y: auto;\">';\n\n    for (let i = 0; i < testCaseCount; i++) {\n        accordion += '<details class=\"card\">';\n        accordion += '<summary class=\"card-header\">';\n        accordion += 'Test ' + (i + 1);\n        // Show if test passed or failed\n        if (results[i] === testsJSON[i].output) {\n            accordion += '<span class=\"badge badge-success float-right\">Passed</span>';\n        } else {\n            accordion += '<span class=\"badge badge-danger float-right\">Failed</span>';\n        }\n        accordion += '</summary>';\n        accordion += '<div class=\"card-body pt-0 pb-0 pl-2 pr-2\">';\n        // eslint-disable-next-line no-loop-func\n        testsJSON[i].inputs.forEach((input) => {\n            for (const key in input) {\n                accordion += '<p class=\"pt-2 m-0\">' + key + ': </p>';\n                accordion += '<pre class=\"mt-1 mb-0 test-input\">' + input[key][0] + '</pre>';\n            }\n        });\n        accordion += '<p class=\"pt-2 border-top mt-2 mb-0\">Test output: </p>';\n        accordion += '<pre class=\"mt-1 mb-0 mr-0 ml-0 test-output\">' + testsJSON[i].output + '</pre>';\n        accordion += '<div class=\"p-0\">';\n        accordion += '<p class=\"pt-2 m-0\">Your output: </p>';\n        accordion += '<pre class=\"pb-2 mt-1 mb-0 ml-0 mr-0 test-output\">' + results[i] + '</pre>';\n        accordion += '</div>';\n        accordion += '</details>';\n    }\n\n    accordion += '</div>';\n    return accordion;\n};\n"],"names":["injectInputBox","i","inputBox","document","createElement","setAttribute","submitButton","innerHTML","getElementById","insertAdjacentElement","replaceCode","code","formatCodeHTML","removeWrapperFunction","lines","split","splice","join","runTests","workspace","tests","getWorkspaceCode","results","forEach","test","thisTestCode","inputs","input","prompt","Object","keys","values","inputIndex","indexOf","inputQuote1","inputQuote2","preStr","substring","postStr","codeOutput","eval","push","javascript","javascriptGenerator","workspaceToCode","testsAccordion","testsJSON","testCaseCount","length","accordion","output","key"],"mappings":";;;;;;;IAaaA,eAAiB,SAACC,OAErBC,SAAWC,SAASC,cAAc,SACxCF,SAASG,aAAa,OAAQ,QAC9BH,SAASG,aAAa,KAAM,kBAAoBJ,OAG1CK,aAAeH,SAASC,cAAc,UAC5CE,aAAaD,aAAa,KAAM,qBAAuBJ,GACvDK,aAAaD,aAAa,OAAQ,UAClCC,aAAaC,UAAY,SAGNJ,SAASK,eAAe,cAChCC,sBAAsB,WAAYP,UAC7CA,SAASO,sBAAsB,WAAYH,0DAOlCI,YAAc,SAACC,MACRR,SAASK,eAAe,WAChCD,UAAYK,eAAeD,4CASjCC,eAAiB,SAACD,YAGb,SAFPA,KAAOE,sBAAsBF,OAEL,UAStBE,sBAAwB,SAACF,UACrBG,MAAQH,KAAKI,MAAM,aACzBD,MAAME,OAAO,EAAG,GAChBF,MAAME,QAAQ,GACPF,MAAMG,KAAK,OAUTC,SAAW,SAAXA,SAAYC,UAAWC,WAE1BT,KAAOU,iBAAiBF,WAC1BG,QAAU,UACdF,MAAMG,SAAQ,SAACC,UACPC,aAAed,KACbe,OAASF,KAAKE,OACpBA,OAAOH,SAAQ,SAACI,WAENC,OAASC,OAAOC,KAAKH,OAAO,GAC5BI,OAASJ,MAAMC,QAEfI,WAAaP,aAAaQ,QAAQL,QAEpCM,YAAcT,aAAaQ,QAAQ,IAAKD,YACtCG,YAAcV,aAAaQ,QAAQ,IAAKC,YAAc,GAEtDE,OAASX,aAAaY,UAAU,EAAGH,YAAc,GACjDI,QAAUb,aAAaY,UAAUF,aAEvCV,aAAeW,OAASL,OAAO,GAAKO,eAIlCC,WAAaC,KAAKf,cACxBH,QAAQmB,KAAKF,eAEVjB,wCASED,iBAAmB,SAACF,eACzBR,KAAO+B,WAAWC,oBAAoBC,gBAAgBzB,kBAM1DR,oDAAkBA,qFAITkC,eAAiB,SAACvB,QAASwB,mBAC9BC,cAAgBD,UAAUE,OAE5BC,UAAY,oDAEPhD,EAAI,EAAGA,EAAI8C,cAAe9C,IAC/BgD,WAAa,yBACbA,WAAa,gCACbA,WAAa,SAAWhD,EAAI,GAExBqB,QAAQrB,KAAO6C,UAAU7C,GAAGiD,OAC5BD,WAAa,8DAEbA,WAAa,6DAEjBA,WAAa,aACbA,WAAa,8CAEbH,UAAU7C,GAAGyB,OAAOH,SAAQ,SAACI,WACpB,IAAMwB,OAAOxB,MACdsB,WAAa,uBAAyBE,IAAM,SAC5CF,WAAa,qCAAuCtB,MAAMwB,KAAK,GAAK,YAG5EF,WAAa,yDACbA,WAAa,gDAAkDH,UAAU7C,GAAGiD,OAAS,SACrFD,WAAa,oBACbA,WAAa,wCACbA,WAAa,qDAAuD3B,QAAQrB,GAAK,SACjFgD,WAAa,SACbA,WAAa,oBAGjBA,WAAa"}
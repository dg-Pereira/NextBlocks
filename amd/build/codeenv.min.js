function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_nextblocks/codeenv",["exports","./lib","./repository"],(function(_exports,_lib,_repository){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.saveState=_exports.init=void 0;var toolbox={kind:"categoryToolbox",readOnly:!0,contents:[{kind:"toolboxlabel",name:"NextBlocks",colour:"darkslategrey"},{kind:"category",name:"Logic",colour:"5b80a5",cssConfig:{icon:"customIcon fa fa-cog"},contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_boolean"}]},{kind:"category",name:"Math",colour:"5b67a5",cssConfig:{icon:"customIcon fa-solid fa-plus-minus"},contents:[{kind:"block",type:"math_number"},{kind:"block",type:"math_arithmetic"}]},{kind:"category",name:"Text",colour:"5ba58c",cssConfig:{icon:"customIcon fa-solid fa-font"},contents:[{kind:"block",type:"text"},{kind:"block",type:"text_print"}]},{kind:"category",name:"Variables",colour:"a55b80",cssConfig:{icon:"customIcon fa-solid fa-clipboard-list"},custom:"VARIABLE"},{kind:"category",name:"Functions",colour:"995ba5",cssConfig:{icon:"customIcon fa-solid fa-code"},custom:"PROCEDURE"},{kind:"category",name:"Input",colour:"180",cssConfig:{icon:"customIcon fa-solid fa-keyboard"},contents:[{kind:"block",type:"text_input"},{kind:"block",type:"text_multiline_input"}]}]},options={toolbox:toolbox,collapse:!0,comments:!0,disable:!0,maxBlocks:1/0,trashcan:!0,horizontalLayout:!1,toolboxPosition:"start",css:!0,media:"https://blockly-demo.appspot.com/static/media/",rtl:!1,scrollbars:!0,sounds:!0,oneBasedIndex:!1,grid:{spacing:20,length:1,colour:"#888",snap:!1},zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2}},nextblocksWorkspace,init=function(contents,loadedSave){var blocklyDiv=document.getElementById("blocklyDiv"),blocklyArea=document.getElementById("blocklyArea");nextblocksWorkspace=Blockly.inject(blocklyDiv,options),new ResizeObserver((function(){return onResize(blocklyArea,blocklyDiv,nextblocksWorkspace)})).observe(blocklyArea);var tests=JSON.parse(contents);null!==tests&&tests[0].inputs.forEach((function(input,i){var inputName=Object.keys(input)[0];(createForcedInputBlock(inputName),null===loadedSave)&&addBlockToWorkspace("forced_input_"+inputName,nextblocksWorkspace).moveBy(0,50*i)}));null!==loadedSave&&loadSave(loadedSave,nextblocksWorkspace),setupButtons(tests,contents,nextblocksWorkspace)};_exports.init=init;var onResize=function(blocklyArea,blocklyDiv,nextblocksWorkspace){var element=blocklyArea,x=0,y=0;do{x+=element.offsetLeft,y+=element.offsetTop,element=element.offsetParent}while(element);blocklyDiv.style.left=x+"px",blocklyDiv.style.top=y+"px",blocklyDiv.style.width=blocklyArea.offsetWidth+"px",blocklyDiv.style.height=blocklyArea.offsetHeight+"px",Blockly.svgResize(nextblocksWorkspace)};function addBlockToWorkspace(blockName,workspace){var newBlock=workspace.newBlock(blockName);return newBlock.initSvg(),newBlock.render(),newBlock}function loadSave(loadedSave,workspace){var state=JSON.parse(atob(loadedSave));Blockly.serialization.workspaces.load(state,workspace)}function setupButtons(tests,contents,workspace){(document.getElementById("runButton").addEventListener("click",(function(){runCode((0,_lib.getWorkspaceCode)(workspace))})),""!==contents)&&document.getElementById("runTestsButton").addEventListener("click",(function(){displayTestResults((0,_lib.runTests)(workspace,tests))}));document.getElementById("saveButton").addEventListener("click",saveState)}var saveState=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var state,stateB64,cmid;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return state=Blockly.serialization.workspaces.save(nextblocksWorkspace),stateB64=btoa(JSON.stringify(state)),cmid=getCMID(),_context.next=5,(0,_repository.saveWorkspace)(cmid,stateB64);case 5:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)}),_ref;function getCMID(){var classList=document.body.classList,cmidClass=Array.from(classList).find((function(className){return className.startsWith("cmid-")}));return parseInt(cmidClass.split("-")[1])}function createForcedInputBlock(prompt){var blockName="forced_input_"+prompt;Blockly.Blocks[blockName]={init:function(){this.appendDummyInput().appendField(prompt).appendField(new Blockly.FieldTextInput("text"),prompt),this.setOutput(!0,"String"),this.setDeletable(!1),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},javascript.javascriptGenerator.forBlock[blockName]=function(block,generator){var text=block.getFieldValue(prompt);return["(function () { let "+prompt+' = "'+text+'"; return '+prompt+";})()",Blockly.JavaScript.ORDER_NONE]}}function displayTestResults(results){var testResultsDiv=document.getElementById("output-div");testResultsDiv.innerHTML="",results.forEach((function(result,i){var testResult=document.createElement("p");testResult.innerHTML="Test "+(i+1)+": "+(result?"Passed":"Failed"),testResultsDiv.appendChild(testResult)}))}function silentRunCode(code){return(0,_lib.replaceCode)(code),eval(code)}function runCode(code){var output=silentRunCode(code);document.getElementById("output-div").innerHTML=output}_exports.saveState=saveState,javascript.javascriptGenerator.forBlock.text_print=function(block,generator){return"outputString += "+(generator.valueToCode(block,"TEXT",Blockly.JavaScript.ORDER_NONE)||"''")+";\n"},Blockly.Blocks.text_input={init:function(){this.appendDummyInput().appendField("text input:").appendField(new Blockly.FieldTextInput("text"),"text_input"),this.setOutput(!0,"String"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.text_multiline_input={init:function(){this.appendDummyInput().appendField("multiline text input:").appendField(new Blockly.FieldMultilineInput("multiline \n text"),"text_input"),this.setOutput(!0,"String"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},javascript.javascriptGenerator.forBlock.text_input=function(block,generator){return['"'+block.getFieldValue("text_input")+'"',Blockly.JavaScript.ORDER_NONE]},javascript.javascriptGenerator.forBlock.text_multiline_input=function(block,generator){return["`"+block.getFieldValue("text_input")+"`",Blockly.JavaScript.ORDER_NONE]};var CustomCategory=function(_Blockly$ToolboxCateg){_inherits(CustomCategory,Blockly.ToolboxCategory);var _super=_createSuper(CustomCategory);function CustomCategory(categoryDef,toolbox,optParent){return _classCallCheck(this,CustomCategory),_super.call(this,categoryDef,toolbox,optParent)}return _createClass(CustomCategory,[{key:"addColourBorder_",value:function(colour){this.rowDiv_.style.backgroundColor=colour}},{key:"setSelected",value:function(isSelected){var labelDom=this.rowDiv_.getElementsByClassName("blocklyTreeLabel")[0];isSelected?(this.rowDiv_.style.backgroundColor="white",labelDom.style.color=this.colour_,this.iconDom_.style.color=this.colour_):(this.rowDiv_.style.backgroundColor=this.colour_,labelDom.style.color="white",this.iconDom_.style.color="white"),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.SELECTED,isSelected)}}]),CustomCategory}(),ToolboxLabel=function(_Blockly$ToolboxItem){_inherits(ToolboxLabel,Blockly.ToolboxItem);var _super2=_createSuper(ToolboxLabel);function ToolboxLabel(toolboxItemDef,parentToolbox){return _classCallCheck(this,ToolboxLabel),_super2.call(this,toolboxItemDef,parentToolbox)}return _createClass(ToolboxLabel,[{key:"init",value:function(){this.label=document.createElement("label"),this.label.textContent=this.toolboxItemDef_.name,this.label.style.color=this.toolboxItemDef_.colour}},{key:"getDiv",value:function(){return this.label}}]),ToolboxLabel}();Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,"toolboxlabel",ToolboxLabel),Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,Blockly.ToolboxCategory.registrationName,CustomCategory,!0)}));

//# sourceMappingURL=codeenv.min.js.map
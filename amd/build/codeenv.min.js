function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}
/**
 *
 * @module      mod_nextblocks/codeenv
 * @copyright   2023 Duarte Pereira<dg.pereira@campus.fct.unl.pt>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */var toolbox={kind:"categoryToolbox",readOnly:!0,contents:[{kind:"toolboxlabel",name:"NextBlocks",colour:"darkslategrey"},{kind:"category",name:"Logic",colour:"5b80a5",cssConfig:{icon:"customIcon fa fa-cog"},contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_boolean"}]},{kind:"category",name:"Math",colour:"5b67a5",cssConfig:{icon:"customIcon fa-solid fa-plus-minus"},contents:[{kind:"block",type:"math_number"},{kind:"block",type:"math_arithmetic"}]},{kind:"category",name:"Text",colour:"5ba58c",cssConfig:{icon:"customIcon fa-solid fa-font"},contents:[{kind:"block",type:"text"},{kind:"block",type:"text_print"}]},{kind:"category",name:"Variables",colour:"a55b80",cssConfig:{icon:"customIcon fa-solid fa-clipboard-list"},custom:"VARIABLE"},{kind:"category",name:"Functions",colour:"995ba5",cssConfig:{icon:"customIcon fa-solid fa-code"},custom:"PROCEDURE"},{kind:"category",name:"Input",colour:"180",cssConfig:{icon:"customIcon fa-solid fa-keyboard"},contents:[{kind:"block",type:"number_input"},{kind:"block",type:"text_input"},{kind:"block",type:"text_multiline_input"}]}]},nextblocksWorkspace;define("mod_nextblocks/codeenv",["mod_nextblocks/lib","mod_nextblocks/repository"],(function(lib,repository){function runCode(code){var outputHTML=lib.silentRunCode(code.getCompleteCodeString()).replace(/\n/g,"<br />");document.getElementById("output-div").innerHTML='<div style="max-height: 100%; overflow-y: auto;"><pre>'.concat(outputHTML,"</pre></div>")}var saveState=function(isTeacherReport){var state=Blockly.serialization.workspaces.save(nextblocksWorkspace),stateB64=btoa(JSON.stringify(state)),cmid=getCMID();if(isTeacherReport){var queryString=window.location.search,userId=new URLSearchParams(queryString).get("userid");repository.saveWorkspace(cmid,stateB64,userId)}else repository.saveWorkspace(cmid,stateB64)},submitWorkspace=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(inputFuncDecs){var codeString,state,stateB64,cmid,delay;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return codeString=lib.getWorkspaceCode(nextblocksWorkspace,inputFuncDecs).getSubmittableCodeString(),state=Blockly.serialization.workspaces.save(nextblocksWorkspace),stateB64=btoa(JSON.stringify(state)),cmid=getCMID(),repository.submitWorkspace(cmid,stateB64,codeString),delay=function(ms){return new Promise((function(res){return setTimeout(res,ms)}))},_context.next=8,delay(1e3);case 8:location.reload();case 9:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref.apply(this,arguments)}),_ref;function displayTestResults(results,tests,uncalledInputFuncs){document.getElementById("output-div").innerHTML=lib.testsAccordion(results,tests,uncalledInputFuncs)}function setupButtons(tests,workspace,inputFuncDecs,lastUserReaction,isTeacherReport){(document.getElementById("runButton").addEventListener("click",(function(){var code=lib.getWorkspaceCode(workspace,inputFuncDecs);lib.replaceCode(code),runCode(code)})),null!==tests)&&document.getElementById("runTestsButton").addEventListener("click",(function(){var code=lib.getWorkspaceCode(workspace,inputFuncDecs).getCompleteCodeString(),uncalledInputFuncs=lib.getMissingInputCalls(code,inputFuncDecs);displayTestResults(uncalledInputFuncs.length>0?null:lib.runTests(code,tests),tests,uncalledInputFuncs)}));document.getElementById("saveButton").addEventListener("click",(function(){saveState(isTeacherReport)}));var submitButton=document.getElementById("submitButton");null!==submitButton&&submitButton.addEventListener("click",(function(){submitWorkspace(inputFuncDecs)}));var lastUserReactionString="";1===lastUserReaction?lastUserReactionString="easy":2===lastUserReaction?lastUserReactionString="medium":3===lastUserReaction&&(lastUserReactionString="hard");var imgs=document.getElementsByClassName("emoji-img");Array.from(imgs).forEach((function(img){var imageType="";img.src.includes("easy")?imageType="easy":img.src.includes("think")?imageType="medium":img.src.includes("hard")&&(imageType="hard"),lastUserReactionString===imageType&&changeImageBackground(img),isTeacherReport||img.addEventListener("click",(function(){repository.submitReaction(getCMID(),imageType).then((function(newReactions){updatePercentages(newReactions.reactionseasy,newReactions.reactionsmedium,newReactions.reactionshard),changeImageBackground(img)}))}))}))}return{init:function init(contents,loadedSave,customBlocks,remainingSubmissions,reactions,lastUserReaction){var reportType=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,userName=arguments.length>7?arguments[7]:void 0,activityId=arguments.length>8?arguments[8]:void 0;2===reportType&&remainingSubmissions>0&&(reportType=0),updatePercentages(reactions[0],reactions[1],reactions[2]);var blocklyDiv=document.getElementById("blocklyDiv"),blocklyArea=document.getElementById("blocklyArea");customBlocks.length>0&&toolbox.contents.push({kind:"category",name:"Custom Blocks",colour:"a55b80",cssConfig:{icon:"customIcon fa-solid fa-code"},contents:[]}),customBlocks.forEach((function(block){var splitTest=block.generator.split("forBlock['"),dotCase=!1;if(splitTest.length<2){if(splitTest=block.generator.split("forBlock."),splitTest.length<2)throw new Error("Invalid generator");dotCase=!0}var blockName=splitTest[1].split(dotCase?" = ":"']")[0].trim();toolbox.contents[toolbox.contents.length-1].contents.push({kind:"block",type:blockName}),eval(block.definition),eval(block.generator)})),nextblocksWorkspace=Blockly.inject(blocklyDiv,getOptions(remainingSubmissions,0!==reportType)),javascript.javascriptGenerator.init(nextblocksWorkspace);var resizeObserver=new ResizeObserver((function(){return onResize(blocklyArea,blocklyDiv,nextblocksWorkspace)}));resizeObserver.observe(blocklyArea);var tests=JSON.parse(contents),inputFunctionDeclarations={funcDecs:""};if(null!==tests){var inputs=tests[0].inputs;inputs.forEach((function(input,i){var inputName=Object.keys(input)[0];(createForcedInputBlock(inputName,Object.keys(input[inputName])[0],inputFunctionDeclarations),null===loadedSave)&&addBlockToWorkspace("forced_input_"+inputName,nextblocksWorkspace).moveBy(0,50*i+50)}))}null!==loadedSave?loadSave(loadedSave,nextblocksWorkspace):addBlockToWorkspace("start",nextblocksWorkspace),0!==reportType&&lockWorkspaceBlocks(nextblocksWorkspace),setupButtons(tests,nextblocksWorkspace,inputFunctionDeclarations.funcDecs,lastUserReaction,1===reportType),runChat(userName,activityId)}}}));var appendMessage=function(message,activityId){var parsedMessage=parseMessage(message);activityId===parsedMessage.activity&&(document.getElementById("messages").innerHTML+="<p>(Activity ".concat(parsedMessage.activity,") ").concat(parsedMessage.sender,": ").concat(parsedMessage.text,"</p>"))},sendMessage=function(message,socket){socket.send(message)},parseMessage=function(message){var msg={type:"",sender:"",text:"",activity:""};try{msg=JSON.parse(message)}catch(e){return!1}return msg},chatSetup=function(socket,userName,activityId){var msgForm=document.querySelector("form.msg-form");msgForm.addEventListener("submit",(function(event){return function(event){event.preventDefault();var msgField=document.getElementById("msg"),msgText=msgField.value,msg={type:"normal",sender:userName,text:msgText,activity:activityId};msg=JSON.stringify(msg),sendMessage(msg,socket),msgField.value=""}(event)}))},runChat=function(userName,activityId){var socket=new WebSocket("ws://localhost:8060");socket.addEventListener("open",(function(){return chatSetup(socket,userName,activityId)})),socket.addEventListener("message",(function(event){return appendMessage(event.data,activityId)}))},lockWorkspaceBlocks=function(workspace){function lockChildren(block){block.getChildren(!1).forEach((function(child){lockBlock(child),child.inputList.forEach((function(input){input.fieldRow.forEach((function(field){field.setEnabled(!1)}))})),lockChildren(child)}))}function lockBlock(block){block.setMovable(!1),block.setDeletable(!1)}workspace.getTopBlocks(!1).forEach((function(block){lockBlock(block),lockChildren(block)}))},changeImageBackground=function(img){var imgs=document.getElementsByClassName("emoji-img");Array.from(imgs).forEach((function(otherImg){otherImg!==img&&(otherImg.classList.remove("bg-primary"),otherImg.classList.add("bg-secondary"))})),img.classList.contains("bg-primary")?(img.classList.remove("bg-primary"),img.classList.add("bg-secondary")):(img.classList.remove("bg-secondary"),img.classList.add("bg-primary"))},updatePercentages=function(easy,medium,hard){var inc=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",elements={easy:document.getElementById("percentage-easy"),medium:document.getElementById("percentage-medium"),hard:document.getElementById("percentage-hard")},values={easy:easy,medium:medium,hard:hard};inc in values&&values[inc]++;var percentages=calcPercentages(values.easy,values.medium,values.hard);elements.easy.innerHTML=percentages[0]+"%",elements.medium.innerHTML=percentages[1]+"%",elements.hard.innerHTML=percentages[2]+"%"},calcPercentages=function(easy,medium,hard){var total=easy+medium+hard;return 0===total?[0,0,0]:[easy,medium,hard].map((function(val){return Math.round(val/total*100)}))},getOptions=function(remainingSubmissions,readOnly){return{toolbox:readOnly?null:toolbox,collapse:!0,comments:!0,disable:!1,maxBlocks:1/0,trashcan:!readOnly,horizontalLayout:!1,toolboxPosition:"start",css:!0,media:"https://blockly-demo.appspot.com/static/media/",rtl:!1,scrollbars:!0,sounds:!0,oneBasedIndex:!1,readOnly:remainingSubmissions<=0,grid:{spacing:20,length:1,colour:"#888",snap:!1},zoom:readOnly?{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2}:null}},onResize=function(blocklyArea,blocklyDiv,nextblocksWorkspace){var element=blocklyArea,x=0,y=0;do{x+=element.offsetLeft,y+=element.offsetTop,element=element.offsetParent}while(element);blocklyDiv.style.left=x+"px",blocklyDiv.style.top=y+"px",blocklyDiv.style.width=blocklyArea.offsetWidth+"px",blocklyDiv.style.height=blocklyArea.offsetHeight+"px",Blockly.svgResize(nextblocksWorkspace)};function addBlockToWorkspace(blockName,workspace){var newBlock=workspace.newBlock(blockName);return newBlock.initSvg(),newBlock.render(),newBlock}function loadSave(loadedSave,workspace){var state=JSON.parse(atob(loadedSave));Blockly.serialization.workspaces.load(state,workspace)}function getCMID(){var classList=document.body.classList,cmidClass=Array.from(classList).find((function(className){return className.startsWith("cmid-")}));return parseInt(cmidClass.split("-")[1])}function createForcedInputBlock(prompt,inputType,inputFunctionDeclarations){var blockName="forced_input_"+prompt;"string"===inputType?(Blockly.Blocks[blockName]={init:function(){this.appendDummyInput().appendField(prompt).appendField(new Blockly.FieldTextInput("text"),prompt),this.setOutput(!0,"String"),this.setDeletable(!1),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},javascript.javascriptGenerator.forBlock[blockName]=function(block,generator){var text=block.getFieldValue(prompt);return["input".concat(prompt,"('").concat(text,"')"),Blockly.JavaScript.ORDER_NONE]}):"number"===inputType&&(Blockly.Blocks[blockName]={init:function(){this.appendDummyInput().appendField(prompt).appendField(new Blockly.FieldNumber(0),prompt),this.setOutput(!0,"Number"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},javascript.javascriptGenerator.forBlock[blockName]=function(block,generator){var number=block.getFieldValue(prompt);return["input".concat(prompt,"(").concat(number,")"),Blockly.JavaScript.ORDER_NONE]}),inputFunctionDeclarations.funcDecs+="function input".concat(prompt,"(string) {\n   return string;\n}\n"),javascript.javascriptGenerator.addReservedWords("input".concat(prompt))}String.prototype.hideWrapperFunction=function(){var lines=this.split("\n");return lines.splice(0,2),lines.join("\n")},javascript.javascriptGenerator.forBlock.text_print=function(block,generator){return"print("+(generator.valueToCode(block,"TEXT",Blockly.JavaScript.ORDER_NONE)||"''")+");\n"},Blockly.Blocks.number_input={init:function(){this.appendDummyInput().appendField("number input").appendField(new Blockly.FieldNumber(0),"number_input"),this.setOutput(!0,"Number"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.text_input={init:function(){this.appendDummyInput().appendField("text input:").appendField(new Blockly.FieldTextInput("text"),"text_input"),this.setOutput(!0,"String"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.text_multiline_input={init:function(){this.appendDummyInput().appendField("multiline text input:").appendField(new Blockly.FieldMultilineInput("multiline \n text"),"text_input"),this.setOutput(!0,"String"),this.setColour(180),this.setTooltip(""),this.setHelpUrl("")}},Blockly.Blocks.start={init:function(){this.appendDummyInput().appendField("start"),this.setNextStatement(!0,null),this.setColour(60),this.setTooltip(""),this.setHelpUrl(""),this.setDeletable(!1)}},javascript.javascriptGenerator.forBlock.start=function(block,generator){return""},javascript.javascriptGenerator.forBlock.number_input=function(block,generator){return["input("+block.getFieldValue("number_input")+")",Blockly.JavaScript.ORDER_NONE]},javascript.javascriptGenerator.forBlock.text_input=function(block,generator){return['input("'+block.getFieldValue("text_input")+'")',Blockly.JavaScript.ORDER_NONE]},javascript.javascriptGenerator.forBlock.text_multiline_input=function(block,generator){return["input(`"+block.getFieldValue("text_input")+"`)",Blockly.JavaScript.ORDER_NONE]};var CustomCategory=function(_Blockly$ToolboxCateg){_inherits(CustomCategory,Blockly.ToolboxCategory);var _super=_createSuper(CustomCategory);function CustomCategory(categoryDef,toolbox,optParent){return _classCallCheck(this,CustomCategory),_super.call(this,categoryDef,toolbox,optParent)}return _createClass(CustomCategory,[{key:"addColourBorder_",value:function(colour){this.rowDiv_.style.backgroundColor=colour}},{key:"setSelected",value:function(isSelected){var labelDom=this.rowDiv_.getElementsByClassName("blocklyTreeLabel")[0];isSelected?(this.rowDiv_.style.backgroundColor="white",labelDom.style.color=this.colour_,this.iconDom_.style.color=this.colour_):(this.rowDiv_.style.backgroundColor=this.colour_,labelDom.style.color="white",this.iconDom_.style.color="white"),Blockly.utils.aria.setState(this.htmlDiv_,Blockly.utils.aria.State.SELECTED,isSelected)}}]),CustomCategory}(),ToolboxLabel=function(_Blockly$ToolboxItem){_inherits(ToolboxLabel,Blockly.ToolboxItem);var _super2=_createSuper(ToolboxLabel);function ToolboxLabel(toolboxItemDef,parentToolbox){return _classCallCheck(this,ToolboxLabel),_super2.call(this,toolboxItemDef,parentToolbox)}return _createClass(ToolboxLabel,[{key:"init",value:function(){this.label=document.createElement("label"),this.label.textContent=this.toolboxItemDef_.name,this.label.style.color=this.toolboxItemDef_.colour}},{key:"getDiv",value:function(){return this.label}}]),ToolboxLabel}();Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,"toolboxlabel",ToolboxLabel),Blockly.registry.register(Blockly.registry.Type.TOOLBOX_ITEM,Blockly.ToolboxCategory.registrationName,CustomCategory,!0);

//# sourceMappingURL=codeenv.min.js.map